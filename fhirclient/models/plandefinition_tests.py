#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
#  Generated from FHIR 1.9.0.11466 on 2017-02-27.
#  2017, SMART Health IT.


import os
import io
import unittest
import json
from . import plandefinition
from .fhirdate import FHIRDate


class PlanDefinitionTests(unittest.TestCase):
    def instantiate_from(self, filename):
        datadir = os.environ.get('FHIR_UNITTEST_DATADIR') or ''
        with io.open(os.path.join(datadir, filename), 'r', encoding='utf-8') as handle:
            js = json.load(handle)
            self.assertEqual("PlanDefinition", js["resourceType"])
        return plandefinition.PlanDefinition(js)
    
    def testPlanDefinition1(self):
        inst = self.instantiate_from("plandefinition-example-kdn5-simplified.json")
        self.assertIsNotNone(inst, "Must have instantiated a PlanDefinition instance")
        self.implPlanDefinition1(inst)
        
        js = inst.as_json()
        self.assertEqual("PlanDefinition", js["resourceType"])
        inst2 = plandefinition.PlanDefinition(js)
        self.implPlanDefinition1(inst2)
    
    def implPlanDefinition1(self, inst):
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].textEquivalent, "Gemcitabine 1250 mg/m² IV over 30 minutes on days 1 and 8")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[1].textEquivalent, "CARBOplatin AUC 5 IV over 30 minutes on Day 1")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].id, "cycle-definition-1")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].textEquivalent, "21-day cycle for 6 cycles")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].timingTiming.repeat.count, 6)
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].timingTiming.repeat.duration, 21)
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].actionDefinition[0].timingTiming.repeat.durationUnit, "d")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].groupingBehavior, "sentence-group")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].selectionBehavior, "exactly-one")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].selectionBehavior, "all")
        self.assertEqual(inst.actionDefinition[0].selectionBehavior, "exactly-one")
        self.assertEqual(inst.approvalDate.date, FHIRDate("2016-07-27").date)
        self.assertEqual(inst.approvalDate.as_json(), "2016-07-27")
        self.assertEqual(inst.contained[0].id, "1111")
        self.assertEqual(inst.contained[1].id, "2222")
        self.assertEqual(inst.contributor[0].name, "Lee Surprenant")
        self.assertEqual(inst.contributor[0].type, "author")
        self.assertEqual(inst.copyright, "All rights reserved.")
        self.assertTrue(inst.experimental)
        self.assertEqual(inst.id, "KDN5")
        self.assertEqual(inst.identifier[0].system, "http://example.org/ordertemplates")
        self.assertEqual(inst.identifier[0].value, "KDN5")
        self.assertEqual(inst.lastReviewDate.date, FHIRDate("2016-07-27").date)
        self.assertEqual(inst.lastReviewDate.as_json(), "2016-07-27")
        self.assertEqual(inst.publisher, "National Comprehensive Cancer Network, Inc.")
        self.assertEqual(inst.relatedArtifact[0].display, "NCCN Guidelines for Kidney Cancer. V.2.2016")
        self.assertEqual(inst.relatedArtifact[0].type, "derived-from")
        self.assertEqual(inst.relatedArtifact[0].url, "http://www.example.org/professionals/physician_gls/PDF/kidney.pdf")
        self.assertEqual(inst.relatedArtifact[1].citation, "Oudard S, et al. J Urol. 2007;177(5):1698-702")
        self.assertEqual(inst.relatedArtifact[1].type, "citation")
        self.assertEqual(inst.relatedArtifact[1].url, "http://www.ncbi.nlm.nih.gov/pubmed/17437788")
        self.assertEqual(inst.status, "draft")
        self.assertEqual(inst.text.status, "additional")
        self.assertEqual(inst.title, "Gemcitabine/CARBOplatin")
        self.assertEqual(inst.type.text, "Chemotherapy Order Template")
        self.assertEqual(inst.useContext[0].code.code, "treamentSetting-or-diseaseStatus")
        self.assertEqual(inst.useContext[0].code.system, "http://example.org/fhir/CodeSystem/indications")
        self.assertEqual(inst.useContext[0].extension[0].url, "http://hl7.org/fhir/StructureDefinition/usagecontext-group")
        self.assertEqual(inst.useContext[0].extension[0].valueString, "A")
        self.assertEqual(inst.useContext[0].valueCodeableConcept.text, "Metastatic")
        self.assertEqual(inst.useContext[1].code.code, "disease-or-histology")
        self.assertEqual(inst.useContext[1].code.system, "http://example.org/fhir/CodeSystem/indications")
        self.assertEqual(inst.useContext[1].extension[0].url, "http://hl7.org/fhir/StructureDefinition/usagecontext-group")
        self.assertEqual(inst.useContext[1].extension[0].valueString, "A")
        self.assertEqual(inst.useContext[1].valueCodeableConcept.text, "Collecting Duct/Medullary Subtypes")
        self.assertEqual(inst.useContext[2].code.code, "focus")
        self.assertEqual(inst.useContext[2].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[2].extension[0].url, "http://hl7.org/fhir/StructureDefinition/usagecontext-group")
        self.assertEqual(inst.useContext[2].extension[0].valueString, "A")
        self.assertEqual(inst.useContext[2].valueCodeableConcept.text, "Kidney Cancer")
        self.assertEqual(inst.useContext[3].code.code, "treatmentSetting-or-diseaseStatus")
        self.assertEqual(inst.useContext[3].code.system, "http://example.org/fhir/CodeSystem/indications")
        self.assertEqual(inst.useContext[3].extension[0].url, "http://hl7.org/fhir/StructureDefinition/usagecontext-group")
        self.assertEqual(inst.useContext[3].extension[0].valueString, "B")
        self.assertEqual(inst.useContext[3].valueCodeableConcept.text, "Relapsed")
        self.assertEqual(inst.useContext[4].code.code, "disease-or-histology")
        self.assertEqual(inst.useContext[4].code.system, "http://example.org/fhir/CodeSystem/indications")
        self.assertEqual(inst.useContext[4].extension[0].url, "http://hl7.org/fhir/StructureDefinition/usagecontext-group")
        self.assertEqual(inst.useContext[4].extension[0].valueString, "B")
        self.assertEqual(inst.useContext[4].valueCodeableConcept.text, "Collecting Duct/Medullary Subtypes")
        self.assertEqual(inst.useContext[5].code.code, "focus")
        self.assertEqual(inst.useContext[5].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[5].extension[0].url, "http://hl7.org/fhir/StructureDefinition/usagecontext-group")
        self.assertEqual(inst.useContext[5].extension[0].valueString, "B")
        self.assertEqual(inst.useContext[5].valueCodeableConcept.text, "Kidney Cancer – Collecting Duct/Medullary Subtypes - Metastatic")
        self.assertEqual(inst.version, "1")
    
    def testPlanDefinition2(self):
        inst = self.instantiate_from("plandefinition-example.json")
        self.assertIsNotNone(inst, "Must have instantiated a PlanDefinition instance")
        self.implPlanDefinition2(inst)
        
        js = inst.as_json()
        self.assertEqual("PlanDefinition", js["resourceType"])
        inst2 = plandefinition.PlanDefinition(js)
        self.implPlanDefinition2(inst2)
    
    def implPlanDefinition2(self, inst):
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[0].expression, "Now()")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[0].path, "timing.event")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[1].expression, "Code '261QM0850X' from SuicideRiskLogic.\"NPI Taxonomy\" display 'Adult Mental Health'")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[1].path, "specialty")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[2].expression, "SuicideRiskLogic.ReferralRequestFulfillmentTime")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[2].path, "occurrenceDateTime")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[3].expression, "SuicideRiskLogic.Patient")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[3].path, "subject")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[4].expression, "SuicideRiskLogic.Practitioner")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[4].path, "requester.agent")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[5].expression, "SuicideRiskLogic.RiskAssessmentScore")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[5].path, "reasonCode")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[6].expression, "SuicideRiskLogic.RiskAssessment")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[6].path, "reasonReference")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].actionDefinition[0].textEquivalent, "Refer to outpatient mental health program for evaluation and treatment of mental health conditions now")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].groupingBehavior, "logical-group")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].selectionBehavior, "any")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[0].title, "Consults and Referrals")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[0].expression, "'draft'")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[0].path, "status")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[1].expression, "SuicideRiskLogic.Patient")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[1].path, "patient")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[2].expression, "SuicideRiskLogic.Practitioner")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[2].path, "prescriber")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[3].expression, "SuicideRiskLogic.RiskAssessmentScore")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[3].path, "reasonCode")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[4].expression, "SuicideRiskLogic.RiskAssessment")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].dynamicValue[4].path, "reasonReference")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[0].textEquivalent, "citalopram 20 mg tablet 1 tablet oral 1 time daily now (30 table; 3 refills)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[1].textEquivalent, "escitalopram 10 mg tablet 1 tablet oral 1 time daily now (30 tablet; 3 refills)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[2].textEquivalent, "fluoxetine 20 mg capsule 1 capsule oral 1 time daily now (30 tablet; 3 refills)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[3].textEquivalent, "paroxetine 20 mg tablet 1 tablet oral 1 time daily now (30 tablet; 3 refills)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].actionDefinition[4].textEquivalent, "sertraline 50 mg tablet 1 tablet oral 1 time daily now (30 tablet; 3 refills)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].documentation[0].document.contentType, "text/html")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].documentation[0].document.title, "National Library of Medicine. DailyMed website. CITALOPRAM- citalopram hydrobromide tablet, film coated.")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].documentation[0].document.url, "http://dailymed.nlm.nih.gov/dailymed/drugInfo.cfm?setid=6daeb45c-451d-b135-bf8f-2d6dff4b6b01")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].documentation[0].type, "justification")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].groupingBehavior, "logical-group")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].selectionBehavior, "at-most-one")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[0].title, "Selective Serotonin Reuptake Inhibitors (Choose a mazimum of one or document reasons for exception)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[1].textEquivalent, "Dopamine Norepinephrine Reuptake Inhibitors (Choose a maximum of one or document reasons for exception)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[2].textEquivalent, "Serotonin Norepinephrine Reuptake Inhibitors (Choose a maximum of one or doument reasons for exception)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].actionDefinition[3].textEquivalent, "Norepinephrine-Serotonin Modulators (Choose a maximum of one or document reasons for exception)")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.contentType, "text/html")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.extension[0].url, "http://hl7.org/fhir/StructureDefinition/cqif-qualityOfEvidence")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.extension[0].valueCodeableConcept.coding[0].code, "high")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.extension[0].valueCodeableConcept.coding[0].system, "http://hl7.org/fhir/evidence-quality")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.extension[0].valueCodeableConcept.text, "High Quality")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.title, "Practice Guideline for the Treatment of Patients with Major Depressive Disorder")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].document.url, "http://psychiatryonline.org/pb/assets/raw/sitewide/practice_guidelines/guidelines/mdd.pdf")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].documentation[0].type, "justification")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].groupingBehavior, "logical-group")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].selectionBehavior, "at-most-one")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].actionDefinition[0].title, "First-Line Antidepressants")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].groupingBehavior, "logical-group")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].selectionBehavior, "at-most-one")
        self.assertEqual(inst.actionDefinition[0].actionDefinition[1].title, "Medications")
        self.assertEqual(inst.actionDefinition[0].title, "Suicide Risk Assessment and Outpatient Management")
        self.assertEqual(inst.approvalDate.date, FHIRDate("2016-03-12").date)
        self.assertEqual(inst.approvalDate.as_json(), "2016-03-12")
        self.assertEqual(inst.contact[0].telecom[0].system, "phone")
        self.assertEqual(inst.contact[0].telecom[0].use, "work")
        self.assertEqual(inst.contact[0].telecom[0].value, "415-362-4007")
        self.assertEqual(inst.contact[0].telecom[1].system, "email")
        self.assertEqual(inst.contact[0].telecom[1].use, "work")
        self.assertEqual(inst.contact[0].telecom[1].value, "info@motivemi.com")
        self.assertEqual(inst.contained[0].id, "referralToMentalHealthCare")
        self.assertEqual(inst.contained[1].id, "citalopramPrescription")
        self.assertEqual(inst.contained[2].id, "citalopramMedication")
        self.assertEqual(inst.contained[3].id, "citalopramSubstance")
        self.assertEqual(inst.contributor[0].contact[0].telecom[0].system, "phone")
        self.assertEqual(inst.contributor[0].contact[0].telecom[0].use, "work")
        self.assertEqual(inst.contributor[0].contact[0].telecom[0].value, "415-362-4007")
        self.assertEqual(inst.contributor[0].contact[0].telecom[1].system, "email")
        self.assertEqual(inst.contributor[0].contact[0].telecom[1].use, "work")
        self.assertEqual(inst.contributor[0].contact[0].telecom[1].value, "info@motivemi.com")
        self.assertEqual(inst.contributor[0].name, "Motive Medical Intelligence")
        self.assertEqual(inst.contributor[0].type, "author")
        self.assertEqual(inst.date.date, FHIRDate("2015-08-15").date)
        self.assertEqual(inst.date.as_json(), "2015-08-15")
        self.assertEqual(inst.description, "Orders to be applied to a patient characterized as low suicide risk.")
        self.assertEqual(inst.effectivePeriod.end.date, FHIRDate("2017-12-31").date)
        self.assertEqual(inst.effectivePeriod.end.as_json(), "2017-12-31")
        self.assertEqual(inst.effectivePeriod.start.date, FHIRDate("2016-01-01").date)
        self.assertEqual(inst.effectivePeriod.start.as_json(), "2016-01-01")
        self.assertEqual(inst.id, "example")
        self.assertEqual(inst.identifier[0].use, "official")
        self.assertEqual(inst.identifier[0].value, "mmi:low-suicide-risk-order-set")
        self.assertEqual(inst.jurisdiction[0].coding[0].code, "US")
        self.assertEqual(inst.jurisdiction[0].coding[0].system, "urn:iso:std:iso:3166")
        self.assertEqual(inst.lastReviewDate.date, FHIRDate("2016-08-15").date)
        self.assertEqual(inst.lastReviewDate.as_json(), "2016-08-15")
        self.assertEqual(inst.publisher, "Motive Medical Intelligence")
        self.assertEqual(inst.purpose, "This order set helps ensure consistent application of appropriate orders for the care of low suicide risk patients.")
        self.assertEqual(inst.status, "draft")
        self.assertEqual(inst.text.status, "generated")
        self.assertEqual(inst.title, "Low Suicide Risk Order Set")
        self.assertEqual(inst.topic[0].text, "Suicide risk assessment")
        self.assertEqual(inst.usage, "This order set should be applied after assessing a patient for suicide risk, when the findings of that assessment indicate the patient has low suicide risk.")
        self.assertEqual(inst.useContext[0].code.code, "age")
        self.assertEqual(inst.useContext[0].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[0].valueCodeableConcept.coding[0].code, "D000328")
        self.assertEqual(inst.useContext[0].valueCodeableConcept.coding[0].display, "Adult")
        self.assertEqual(inst.useContext[0].valueCodeableConcept.coding[0].system, "https://meshb.nlm.nih.gov")
        self.assertEqual(inst.useContext[1].code.code, "focus")
        self.assertEqual(inst.useContext[1].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[1].valueCodeableConcept.coding[0].code, "87512008")
        self.assertEqual(inst.useContext[1].valueCodeableConcept.coding[0].display, "Mild major depression")
        self.assertEqual(inst.useContext[1].valueCodeableConcept.coding[0].system, "http://snomed.info/sct")
        self.assertEqual(inst.useContext[2].code.code, "focus")
        self.assertEqual(inst.useContext[2].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[2].valueCodeableConcept.coding[0].code, "40379007")
        self.assertEqual(inst.useContext[2].valueCodeableConcept.coding[0].display, "Major depression, recurrent, mild")
        self.assertEqual(inst.useContext[2].valueCodeableConcept.coding[0].system, "http://snomed.info/sct")
        self.assertEqual(inst.useContext[3].code.code, "focus")
        self.assertEqual(inst.useContext[3].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[3].valueCodeableConcept.coding[0].code, "394687007")
        self.assertEqual(inst.useContext[3].valueCodeableConcept.coding[0].display, "Low suicide risk")
        self.assertEqual(inst.useContext[3].valueCodeableConcept.coding[0].system, "http://snomed.info/sct")
        self.assertEqual(inst.useContext[4].code.code, "focus")
        self.assertEqual(inst.useContext[4].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[4].valueCodeableConcept.coding[0].code, "225337009")
        self.assertEqual(inst.useContext[4].valueCodeableConcept.coding[0].display, "Suicide risk assessment")
        self.assertEqual(inst.useContext[4].valueCodeableConcept.coding[0].system, "http://snomed.info/sct")
        self.assertEqual(inst.useContext[5].code.code, "user")
        self.assertEqual(inst.useContext[5].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[5].valueCodeableConcept.coding[0].code, "309343006")
        self.assertEqual(inst.useContext[5].valueCodeableConcept.coding[0].display, "Physician")
        self.assertEqual(inst.useContext[5].valueCodeableConcept.coding[0].system, "http://snomed.info/sct")
        self.assertEqual(inst.useContext[6].code.code, "venue")
        self.assertEqual(inst.useContext[6].code.system, "http://hl7.org/fhir/usage-context-type")
        self.assertEqual(inst.useContext[6].valueCodeableConcept.coding[0].code, "440655000")
        self.assertEqual(inst.useContext[6].valueCodeableConcept.coding[0].display, "Outpatient environment")
        self.assertEqual(inst.useContext[6].valueCodeableConcept.coding[0].system, "http://snomed.info/sct")
        self.assertEqual(inst.version, "1.0.0")
    
    def testPlanDefinition3(self):
        inst = self.instantiate_from("plandefinition-protocol-example.json")
        self.assertIsNotNone(inst, "Must have instantiated a PlanDefinition instance")
        self.implPlanDefinition3(inst)
        
        js = inst.as_json()
        self.assertEqual("PlanDefinition", js["resourceType"])
        inst2 = plandefinition.PlanDefinition(js)
        self.implPlanDefinition3(inst2)
    
    def implPlanDefinition3(self, inst):
        self.assertEqual(inst.actionDefinition[0].condition[0].expression, "Observation of Obesity or BMI Measured in Past 2 Years")
        self.assertEqual(inst.actionDefinition[0].condition[0].kind, "applicability")
        self.assertEqual(inst.actionDefinition[0].label, "Measure BMI")
        self.assertEqual(inst.actionDefinition[0].title, "Measure, Weight, Height, Waist, Circumference; Calculate BMI")
        self.assertEqual(inst.contained[0].id, "procedure")
        self.assertEqual(inst.contributor[0].name, "National Heart, Lung, and Blood Institute http://www.nhlbi.nih.gov/health-pro/guidelines/current/obesity-guidelines/e_textbook/txgd/algorthm/algorthm.htm")
        self.assertEqual(inst.contributor[0].type, "author")
        self.assertEqual(inst.id, "protocol-example")
        self.assertEqual(inst.identifier[0].system, "http://acme.org")
        self.assertEqual(inst.identifier[0].value, "example-1")
        self.assertEqual(inst.purpose, "Example of A medical algorithm for assessment and treatment of overweight and obesity")
        self.assertEqual(inst.status, "draft")
        self.assertEqual(inst.text.status, "generated")
        self.assertEqual(inst.title, "Obesity Assessment Protocol")
        self.assertEqual(inst.type.coding[0].code, "protocol")

